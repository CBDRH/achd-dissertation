---
title: "SA2 Lookup Table"
author: "Calum Nicholson"
date: "08/06/2020"
output: html_document
---

```{r setup, include=FALSE, cache = FALSE}
knitr::opts_chunk$set(echo = TRUE)
# set 'data' folder as root directory
knitr::opts_knit$set(root.dir = '../..')

library(dplyr)
```

## The SA2 Coding index 

Allows SA2 areas to be looked up using with locality (suburb), Postcode and State.
  
``` {r}
# Import SA2 coding index
SA2_locality <- read.csv('./ASGS/asgs2016codingindexes/2019 Locality to 2016 SA2 Coding Index.csv')

# filter for NSW
SA2_locality_NSW <- SA2_locality %>%
                    filter(STATE == "NSW" | STATE == "ACT")
# Get distinct SA2 names
SA2_locality_names <- SA2_locality_NSW %>%
                      distinct(SA2_NAME)

```

## Check how the coding index compared with the total list of SA2 areas

``` {r}
# Load the list of ASGS SA2 area names and codes
SA2_aus <- read.csv('./ASGS/SA2_2016_AUST.csv') %>%
            select(STATE_NAME_2016, SA2_MAINCODE_2016, SA2_5DIGITCODE_2016, SA2_NAME_2016,
                   SA3_CODE_2016, SA3_NAME_2016, SA4_CODE_2016, SA4_NAME_2016)

# filter for NSW and select the column with SA2 names
SA2_nsw <- SA2_aus %>%
            filter(STATE_NAME_2016 == "New South Wales" | STATE_NAME_2016 == "Australian Capital Territory")
```


``` {r}
#Get missing records
missing.records <- anti_join(SA2_nsw, SA2_locality_names, by = c("SA2_NAME_2016" = "SA2_NAME"))

missing.records
```


A number of SA2 areas are missing from the localities index but looking at the documentation (Dissertation/data/ASGS/asgs2016codingindexes/2017 Locality to 2016 SA2 Coding Index Documentation.docx) we can see the methods used to create the coding indexes:

_This means where a locality is covered by two or more SA2s the locality has been allocated to the SA2 where most of its population are located according to the underlying grid.  This ensures a specific gazetted locality/alias/extra locality entry is represented only once in the file and is allocated wholly to a specific SA2._

This method may mean that some SA2 areas have been excluded because the locality has been placed into the area where most of its population is.

``` {r}
# join the SA3 and SA4 area codes to the look up table
ASGS_lookup <- left_join(SA2_locality_NSW, SA2_aus, by = c("SA2_MAINCODE" = "SA2_MAINCODE_2016")) %>%
                    select(-LOCALITY_ID, -LOCALITY_TYPE, -STATE_NAME_2016, -SA2_NAME_2016)

```

``` {r}
# check for missingness in the ASGS lookup
sapply(ASGS_lookup, function(x) sum(is.na(x)))

ASGS_lookup %>% filter(is.na(POSTCODE))
```


``` {r}
# Select Nessecary columns from lookup table
SA2_lookup_NSW <- SA2_locality_NSW %>%
                   select(LOCALITY_NAME, POSTCODE, SA2_MAINCODE, SA2_NAME)

# write the filtered lookup table to the output folder
# write.csv(SA2_lookup_NSW, "./achd-dissertation/EDA/output/sa2_lookup.csv")
# write.csv(ASGS_lookup, "./achd-dissertation/EDA/output/ASGS_lookup.csv")


```



